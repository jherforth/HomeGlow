services:
  backend-test:
    container_name: backend-test
    build:
      context: ./server
      dockerfile: Dockerfile
      args:
        - PORT=${BACKEND_PORT:-5001}
    ports:
      - "${BACKEND_PORT:-5001}:${BACKEND_PORT:-5001}"
    volumes:
      - /apps/homeglow/data:/app/data
      - /apps/homeglow/uploads:/app/uploads
    environment:
      - NODE_ENV=development
      - PORT=${BACKEND_PORT:-5001}
    networks:
      - homeglow-network

  frontend-test:
    container_name: frontend-test
    build:
      context: ./client
      dockerfile: Dockerfile.dev
    ports:
      - "${FRONTEND_PORT:-3001}:3001"
    volumes:
      # Mount entire src directory (this works because it's a directory)
      - ./client/src:/app/src:delegated
      - ./client/public:/app/public:delegated
      
      # Mount individual config files (now works because /app exists from COPY . .)
      - ./client/index.html:/app/index.html:delegated
      - ./client/vite.config.js:/app/vite.config.js:delegated
      
      # Protect node_modules and package.json from being overwritten
      - /app/node_modules
      - /app/package.json
      - /app/package-lock.json
    environment:
      - VITE_OPENWEATHER_API_KEY=${VITE_OPENWEATHER_API_KEY}
      - VITE_REACT_APP_API_URL=${VITE_REACT_APP_API_URL}:${BACKEND_PORT:-5001}
    depends_on:
      - backend-test
    networks:
      - homeglow-network

networks:
  homeglow-network:
    driver: bridge
